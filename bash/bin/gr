#!/bin/bash
# {{{ Program overview.
#
# Name:
#   gr nvim [https] [nvin.traap]
#
# Purpose:
#   Clone or pull a Git repository using HTTPS or GIT protocol.
#
# Arguments:
#   1 - repository to clone
#   2 - optionl: use HTTPS versus GIT protocol when present.
#   3 - d
#
# Use:
#   gr nvim
#   gr nvim  https
#   gr nvim https nvim.traap
#
#   Note:  any 2nd argument uses https
#
# -------------------------------------------------------------------------- }}}
# {{{ Capture current directory.

dir=$(pwd)

# -------------------------------------------------------------------------- }}}
# {{{ Determine when a clone or pull is needed.

if [ "$#" -eq 1 ]; then
  if [ -d "$1" ]; then
    operation=pull
  else
    operation=clone
  fi
else
  if [ -d "$2" ]; then
    operation=pull
  else
    operation=clone
  fi
fi

# -------------------------------------------------------------------------- }}}
# {{{ Determine when HTTPS or GIT protocol is used.

if [ "$#" -eq 3 ]; then
	protocol=git@github.com:Traap/"$1".git
else
	protocol=https://github.com/Traap/"$1"
fi

# -------------------------------------------------------------------------- }}}
# {{{ Do the clone or pull operation.

if [ ${operation} = 'pull' ]; then
	cd "$1" || exit
	sayAndDo "git $operation"
	cd "$dir" || exit
else
  if [ "$#" -eq 2 ]; then
  	sayAndDo "git $operation $protocol $2"
  else
  	sayAndDo "git $operation $protocol"
  fi
fi

# -------------------------------------------------------------------------- }}}
# {{{ Get all tags.

cd "$1" || exit
sayAndDo "git fetch --all --tags"

# -------------------------------------------------------------------------- }}}
# {{{ Restore the orginal directory.

cd "$dir" || exit

# -------------------------------------------------------------------------- }}}
