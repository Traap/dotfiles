#!/bin/bash
# {{{ AO credits and documentation.
#
# Inspired by:
#  Doug Bell - "Organized Development with tmux", Jun 18, 2019
#               Conference in the Cloud A Perl and Raku Conf
#
# https://www.youtube.com/watch?v=o7Dg1kmjhfQ&t=2428s
#
# Name: Alpha and Omega
#   ao
#
# Use:
#  ao kjv
#
# Argument:
#  $1 tmux session name
#
# Notes:
#   1. A session is created or attached to.
#   2. A new session is added if ao is used from with a tmux session.
#
# -------------------------------------------------------------------------- }}}
# {{{ function to clone or pull a repository as needed.

getRepository() {
  dir=$(pwd)

  (cd "$GITPATH" && gr "$1" && cd "$dir") || (echo "GITPATH is not defined." && exit)
}

# -------------------------------------------------------------------------- }}}
# {{{ Validate request includes one session name.

if [[ $# -eq 1 ]]; then

  # ------------------------------------------------------------------------ }}}
  # {{{ Validate session name.

  if ! tmux has-session -t "$1" 2>/dev/null; then
    case $1 in

    # ---------------------------------------------------------------------- }}}
    # {{{ Create ao session

    "ao")
      tmux new-session -c "$BASHHOME"/bin -n Coder -s "$1" -d
      tmux send-keys -t "$1":1 "$EDITOR ao" Enter
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create d (doub le), h (homerun), t (triple)

    "d")
      tmux new-session -n Double -s "$1"\; split-window -bh
      ;;

    "h")
      tmux new-session -n HomeRun -s "$1"\; split-window -bh\; split-window -bv -t 2\; split-window -bv -t 1
      ;;

    "t")
      tmux new-session -n Triple -s "$1"\; split-window -v\; split-window -bfh
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create bash session

    "bash")
      getRepository dotfiles

      tmux new-session -c "$BASHHOME" -n dotfiles -s "$1" -d
      tmux new-window -c "$BASHHOME" -n bashrc -t "$1":2

      tmux send-keys -t "$1":2 \
        "$EDITOR \
        bashrc \
        bashrc-personal \
        bash_logout \
        my_aliases \
        my_completions \
        my_exports \
        my_functions \
        my_paths \
        my_prompt \
      " Enter

      tmux select-window -t "$1":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create havasu session

    "havasu")
      getRepository havasu
      tmux new-session -c "$GITPATH"/havasu -n Coder -s "$1" -d
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create KJV session

    "kjv")
      getRepository kjv
      tmux new-session -c "$GITPATH"/kjv -n av -s "$1" -d
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create nvim session

    "nvim")
      tmux new-session -c "$GITPATH/nvim.traap" -n Coder -s "$1" -d
      tmux send-keys -t "$1":1 \
        'nvim \
          init.lua \
          lua/config/lazy.lua \
          lua/config/traap/autocmds.lua \
          lua/config/traap/constants.lua \
          lua/config/traap/customize.lua \
          lua/config/traap/globals.lua \
          lua/config/traap/keymaps.lua \
          lua/config/traap/options.lua \
        ' Enter
      tmux select-window -t "$1":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create tmux session

    "tmux")
      tmux new-session -c "$GITPATH"/tmux -n Coder -s "$1" -d
      tmux send-keys -t "$1":1 "$EDITOR tmux.conf" Enter
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create vim session

    "vim")
      getRepository vim
      tmux new-session -c "$GITPATH"/vim -n Coder -s "$1" -d

      tmux send-keys -t "$1":1 \
        "vim \
        plug.vim \
        bundle/vim-bundle-keybindings/plugin/bundle-keybindings.vim \
        bundle/vim-bundle-settings/plugin/bundle-settings.vim \
        vimrc \
        bootstrap.vim \
        " Enter

      tmux select-window -t "$1":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create wiki session

    "wiki")

      # TODO:  Disable email.  Does hey-mail support neomutt?
      getRepository wiki
      tmux new-session -c "$GITPATH"/wiki -n Notebook -s "$1" -d
      tmux new-window -c "$GITPATH" -n 'Coder' -t "$1":2

      tmux send-keys -t "$1":1 "$EDITOR $GITHOME/wiki/index.md" Enter
      tmux select-window -t "$1":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Youtube session

    "YouTube")
      tmux new-session -c "$GITHOME" -n YouTube -s "$1" -d
      tmux new-window -c "$GITPATH" -n 'Coder' -t "$1":2
      tmux new-window -c "$GITPATH" -n 'Demo' -t "$1":3

      tmux send-keys -t "$1":1 "$EDITOR $GITHOME"/youtube/wiki/index.md Enter
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Session name not supported error.

    *)
      echo "Session name $1 is not supported."
      exit
      ;;
    esac
  else
    echo "Attaching to existing tmux session."
  fi

# -------------------------------------------------------------------------- }}}
# {{{ Display usage

else
  echo \
    "Session name [ao|bash|d|h|havasu|kjv|nvim|ssh|soup|t|vim|wiki|YouTube] is required" &&
    exit
fi

# -------------------------------------------------------------------------- }}}
# {{{ Attach to tmux session.

[[ -z $TMUX ]] && tmux attach -t "$1"
exit 0

# -------------------------------------------------------------------------- }}}
