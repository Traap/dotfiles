#!/usr/bin/env bash
# {{{ AO credits and documentation.
#
# Inspired by:
#  Doug Bell - "Organized Development with tmux", Jun 18, 2019
#               Conference in the Cloud A Perl and Raku Conf
#
# https://www.youtube.com/watch?v=o7Dg1kmjhfQ&t=2428s
#
# Name: Alpha and Omega
#   ao
#
# Use:
#  ao kjv
#
# Argument:
#  $SESSION tmux session name
#
# Notes:
#   1. A session is created or attached to.
#   2. A new session is added if ao is used from with a tmux session.
#
# -------------------------------------------------------------------------- }}}
# {{{ function to clone or pull a repository as needed.

# Note:  In practice, I only clone repositories that are infrequently used.

getRepository() {
  dir=$(pwd)

  (cd "$GITPATH" && gr "$1" && cd "$dir") || (echo "GITPATH is not defined." && exit)
}

# -------------------------------------------------------------------------- }}}
# {{{ Validate request includes one session name.

if  [[ $# -eq 1 ]]; then

  # ------------------------------------------------------------------------ }}}
  # {{{ Validate session name.

 SESSION=$1
  if ! tmux has-session -t "$SESSION" 2>/dev/null; then
    case "$SESSION" in

    # ---------------------------------------------------------------------- }}}
    # {{{ Create ao session

    "ao")
      WORKDIR="$BASHHOME/bin"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux send-keys   -t "$SESSION":1 "$EDITOR ao" Enter
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create d (double), h (homerun), t (triple)

    "d")
      tmux new-session  -s "$SESSION" -n Double -d
      tmux split-window -bh
      ;;

    "h")
      tmux new-session  -s "$SESSION" -n HomeRun -d
      tmux split-window -bh
      tmux split-window -bv -t 2
      tmux split-window -bv -t 1
      ;;

    "t")
      tmux new-session  -s "$SESSION" -n Triple -d
      tmux split-window -v
      tmux split-window -bfh
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create bash session

    "bash")
      WORKDIR="$BASHHOME"

      tmux new-session -s "$SESSION"   -c "$WORKDIR" -n dotfiles -d
      tmux new-window  -s "$SESSION":2 -c "$WORKDIR" -c "$BASHHOME" -n bashrc

      tmux send-keys -t "$SESSION":2 \
        "$EDITOR \
        bashrc \
        bashrc-personal \
        bash_logout \
        my_aliases \
        my_completions \
        my_exports \
        my_functions \
        my_paths \
        my_prompt \
      " Enter

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Bracco session

    "Bracco")
      WORKDIR="$HOME/bracco"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux new-window  -s "$SETTION" -c "$WORKDIR" -n 'Tester'

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create havasu session

    "havasu")
      WORKDIR="$GITPATH/havasu"

      getRepository havasu
      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create KJV session

    "kjv")
      WORKDIR="$GITPATH/kjv"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 1611 -d
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Nvim session

    "Neovim")
      WORKDIR="$GITPATH/nvim.traap"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux send-keys   -t "$SESSION":1 \
        'nvim \
          init.lua \
          lua/traap/config/autocmds.lua \
          lua/traap/config/keymaps.lua \
          lua/traap/config/lazy.lua \
          lua/traap/config/options.lua \
          lua/traap/core/constants.lua \
          lua/traap/core/globals.lua \
        ' Enter
      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Hyprland session

    "Hyprland")
      WORKDIR="$DOTHOME/hypr"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux send-keys   -t "$SESSION":1 \
        'nvim \
          hyprland.conf \
          config/animations.conf \
          config/autostart.conf \
          config/bindings.conf \
          config/envs.conf \
          config/input.conf \
          config/monitors.conf \
          config/windowrules.conf \
          config/workspacerules.conf\
        ' Enter
      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Paperboy session

    "Paperboy")
      WORKDIR="$WORKHOME/Paperboy"

      tmux new-session   -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux send-keys     -t "$SESSION":1 "nvim" Enter

      tmux new-window    -t "$SESSION":2 -c "$WORKDIR" -n 'Tester'
      tmux split-window  -t "$SESSION":2 -c "$WORKDIR" -bh

      tmux send-keys     -t "$SESSION":2.1 "bin/rails s -p 3001" Enter
      tmux send-keys     -t "$SESSION":2.2 "bundle exec sidekiq -v" Enter

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Scratchpad session

    "Scratchpad")
      WORKDIR="$WIKIHOME"

      tmux new-session   -s "$SESSION" -c "$WORKDIR" -n 'Quick' -d
      tmux send-keys     -t "$SESSION":1 "$EDITOR +WikiJournal" Enter
      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create tmux session

    "tmux")
      WORKDIR="$GITPATH/tmux"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux send-keys   -t "$SESSION":1 "$EDITOR tmux.conf" Enter
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create vim session

    "vim")
      WORKDIR="$GITPATH/vim"

      getRepository vim
      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d

      tmux send-keys -t "$SESSION":1 \
        "vim \
        plug.vim \
        bundle/vim-bundle-keybindings/plugin/bundle-keybindings.vim \
        bundle/vim-bundle-settings/plugin/bundle-settings.vim \
        vimrc \
        bootstrap.vim \
        " Enter

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Upgrade session

    "Upgrade")
      WORKDIR="$BASHHOME/bin"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Admin' -d
      tmux split-window -bh

      tmux send-keys -t "$SESSION":1 "upgrade" Enter
      tmux send-keys -t "$SESSION":2 "gits -v" Enter

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Wiki session

    "Wiki")
      WORKDIR="$GITHOME/wiki"

      tmux new-session   -s "$SESSION" -c "$WORKDIR" -n 'Notebook' -d
      tmux split-window -bh

      tmux send-keys -t "$SESSION":1 "$EDITOR $WIKIHOME/index.md" Enter

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Work session

    "Work")
      WORKDIR="$WORKHOME/Wiki"

      tmux new-session   -s "$SESSION" -c "$WORKDIR" -n 'Notebook' -d
      tmux split-window -bh

      tmux send-keys -t "$SESSION":1 "$EDITOR $WIKIHOME/index.md" Enter

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create YouTube session

    "YouTube")
      WORKDIR="$YOUTUBEHOME"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Notes' -d
      tmux new-window  -c "$YOUTUBEHOME/lsp" -n 'Coder' -t "$SESSION":2
      tmux new-window  -c "$YOUTUBEHOME/lsp" -n 'Demo' -t "$SESSION":3

      tmux send-keys -t "$SESSION":1 "$EDITOR $YOUTUBEHOME"/wiki/index.md Enter
      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Create Zero session

    "Zero")
      WORKDIR="$GITPATH"

      tmux new-session -s "$SESSION" -c "$WORKDIR" -n 'Coder' -d
      tmux new-window  -s "$SETTION" -c "$WORKDIR" -n 'Tester'

      tmux select-window -t "$SESSION":1
      ;;

    # ---------------------------------------------------------------------- }}}
    # {{{ Session name not supported error.

    *)
      echo "Session name $SESSION is not supported."
      exit
      ;;
    esac
  else
    echo "Attaching to existing tmux session."
  fi

# -------------------------------------------------------------------------- }}}
# {{{ Display usage

else
  echo \
    "Session name ao|bash|Bracco|d|h|havasu|kjv|Nvim|Omarchy|Scratchpad|t|Upgrade|vim|Wiki|YouTube|Zero is required" &&
    exit
fi

# -------------------------------------------------------------------------- }}}
# {{{ Attach to tmux session.

 [ -z "$TMUX" ]  && tmux attach -t "$SESSION"
exit 0

# -------------------------------------------------------------------------- }}}
